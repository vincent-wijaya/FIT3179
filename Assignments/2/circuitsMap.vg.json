{
    "$schema": "https://vega.github.io/schema/vega/v5.json",
    "width": 800,
    "height": 500,
    "title": {
        "text": "Circuits Formula 1 Raced On",
        "frame": "bounds"
    },
    "autosize": "none",
    "params": 
    [
        {
            "name": "Year_selection",
            "value": 2022,
            "bind": {
                "input": "range",
                "min": 1950,
                "max": 2022,
                "step": 1,
                "name": "Year: "
            }
        },
        {
            "name": "zoom_level",
            "value": 130,
            "bind": {
                "input": "range",
                "min": 130,
                "max": 1500,
                "step": 10,
                "name": "Zoom: "
            }
        },
        {
            "name": "center_to",
            "value": [0, 0],
            "bind": {
                "input": "select",
                "options": [
                    [0, 0],
                    [12, 50],
                    [47, 25],
                    [-100, 38]
                ],
                "labels": ["World", "Central Europe", "Middle East Asia", "United States"],
                "name": "Map Centre: "
            } 
        }  
    ],
    "signals": 
    [
        { "name": "tx", "update": "width / 2" },
        { "name": "ty", "update": "height / 2" },
        {
            "name": "scale",
            "value": 150,
            "on": [{
                "events": {"type": "wheel", "consume": true},
                "update": "clamp(scale * pow(1.0005, -event.deltaY * pow(16, event.deltaMode)), 150, 3000)"
          }]
        },
        {
            "name": "angles",
            "value": [0, 0],
            "on": [{
                "events": "mousedown",
                "update": "[rotateX, centerY]"
            }]
        },
        {
            "name": "cloned",
            "value": null,
            "on": [{
                "events": "mousedown",
                "update": "copy('projection')"
            }]
        },
        {
            "name": "start",
            "value": null,
            "on": [{
                "events": "mousedown",
                "update": "invert(cloned, xy())"
            }]
        },
        {
            "name": "drag", "value": null,
            "on": [{
                "events": "[mousedown, window:mouseup] > window:mousemove",
                "update": "invert(cloned, xy())"
            }]
        },
        {
            "name": "delta", "value": null,
            "on": [{
                "events": {"signal": "drag"},
                "update": "[drag[0] - start[0], start[1] - drag[1]]"
            }]
        },
        {
            "name": "rotateX", "value": 0,
            "on": [{
                "events": {"signal": "delta"},
                "update": "angles[0] + delta[0]"
            }]
        },
        {
            "name": "centerY", "value": 0,
            "on": [{
                "events": {"signal": "delta"},
                "update": "clamp(angles[1] + delta[1], -60, 60)"
            }]
        }
    ],
    
    "projections": [
        {
            "name": "projection",
            "type": "mercator",
            "scale": {"signal": "scale"},
            "rotate": [{"signal": "rotateX"}, 0, 0],
            "center": [0, {"signal": "centerY"}],
            "translate": [{"signal": "tx"}, {"signal": "ty"}]
        }
    ],
    "layer": [
        {
            "data": {
                "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/7_others/oceans.topojson",
                "format": {"type": "topojson", "feature": "oceans"}
            },
            "mark": {"type": "geoshape", "projection": "projection", "fill": "skyblue"}
        },
        {
            "data": {
                "url": "https://raw.githubusercontent.com/vincent-wijaya/FIT3179/main/Assignments/2/data/ne_110m_satellite.json",
                "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
            },
            "mark": {"type": "geoshape", "projection": "projection", "fill": "lightgray", "stroke": "white", "strokeWidth": 0.7}
        },
        {
            "data": {
                "url": "https://raw.githubusercontent.com/vincent-wijaya/FIT3179/main/Assignments/2/data/ne_110m.json",
                "format": {"type": "topojson", "feature": "ne_110m_graticules_30"}
            },
            "mark": {"type": "geoshape", "projection": "projection", "stroke": "black", "fill": null},
            "encoding": {"opacity": {"value": 0.3}}
        },
        {
            "data": 
            {
                "url": "https://raw.githubusercontent.com/vincent-wijaya/FIT3179/main/Assignments/2/data/races.csv",
                "format": {
                    "type": "csv",
                    "parse": {"year": "number"}
                }
            },
            "encoding": {
            "longitude": {"field": "lng", "type": "quantitative"},
            "latitude": {"field": "lat", "type": "quantitative"}
            },
            "transform": [
                {
                    "lookup": "circuitId", "from": 
                    {
                        "data": {
                            "url": "https://raw.githubusercontent.com/vincent-wijaya/FIT3179/main/Assignments/2/data/circuits.csv",
                            "format":
                            {
                                "type": "csv",
                                "parse": {"lng": "number", "lat": "number", "country": "string", "location": "string"}
                            }
                        },
                        "key": "circuitId",
                        "fields":["lng", "lat", "country", "location"]
                    }
                },
                {"filter": "datum.year == Year_selection"}
            ],
            "layer":
            [
                {
                    "mark": {"type": "square", "tooltip": {"content": "data"}, "size": 11},
                    "encoding": {
                        "size": {"value": 15},
                        "color": {"value": "red"},
                        "opacity": {"value": 0.7},
                        "tooltip": [
                            {"field": "name", "type": "nominal", "title": "Circuit Name"},
                            {"field": "location", "type": "nominal", "title": "Location"},
                            {"field": "country", "type": "nominal", "title": "Country"}
                        ]
                    }
                },
                {
                    "mark": {
                        "type": "text",
                        "dy": -10,
                        "fontWeight": "bold"
                    },
                    "encoding": {
                        "text": {"field": "location", "type": "nominal"},
                        "color": {"value": "black"},
                        "opacity": {"value": 0.8},
                        "tooltip": [
                            {"field": "name", "type": "nominal", "title": "Circuit Name"},
                            {"field": "location", "type": "nominal", "title": "Location"},
                            {"field": "country", "type": "nominal", "title": "Country"}
                        ]
                    }
                }
            ]
        }
    ]
}